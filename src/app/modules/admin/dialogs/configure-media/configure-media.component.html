<ng-container *transloco="let t">
  <ng-container *ngIf="media">
    <div class="tw-flex tw-flex-wrap">
      <div class="tw-w-2/5 sm:tw-w-1/5 tw-mx-auto sm:tw-mx-0">
        <div class="tw-aspect-w-2 tw-aspect-h-3 tw-rounded-xl tw-overflow-hidden">
          <img *ngIf="media.thumbnailPosterUrl; else noPoster" class="tw-object-cover"
            [lazyLoad]="media.thumbnailPosterUrl" [alt]="media.title" errorImage="assets/images/media-poster-md.png">
          <div *ngIf="media.posterColor" class="ng-lazyload-placeholder tw-w-full tw-h-full"
            [ngStyle]="{ 'background-color': media.posterColor | hexColor }">
          </div>
          <ng-template #noPoster>
            <img class="tw-object-cover" lazyLoad="assets/images/media-poster-md.png"
              defaultImage="assets/images/media-poster-sm.png" [alt]="media.title">
          </ng-template>
        </div>
      </div>
      <div class="tw-w-full sm:tw-w-4/5 tw-mt-4 sm:tw-mt-0 sm:tw-pl-8">
        <p class="tw-text-white tw-text-center sm:tw-text-left tw-text-xl sm:tw-text-2xl md:tw-text-3xl tw-font-bold">
          {{ media.title }}
        </p>
        <p *ngIf="media.originalTitle"
          class="tw-text-slate-400 tw-text-center sm:tw-text-left tw-text-sm md:tw-text-base tw-mt-1">
          {{ media.originalTitle }}
        </p>
        <p class="tw-text-white tw-text-base tw-mt-4 tw-text-center sm:tw-text-left">
          <span *ngIf="media.type === MediaType.MOVIE; else isTV"
            class="tw-border tw-text-sm tw-px-1.5 tw-py-1 tw-rounded-2xl">Movie</span>
          <ng-template #isTV>
            <span class="tw-border tw-text-sm tw-px-1.5 tw-py-1 tw-rounded-2xl">TV Show</span>
          </ng-template>
          <span class="tw-ml-3 tw-text-base">
            <i class="pi pi-clock tw-text-sm"></i>
            {{ t('media.details.runtimeValue', { runtime: media.runtime}) }}
          </span>
        </p>
        <p class="tw-text-white tw-text-base tw-mt-4 tw-text-center sm:tw-text-left">
          <ng-container *ngIf="media.genres.length; else noGenres">
            <span *ngFor="let genre of media.genres; trackBy: trackId" class="tw-ml-2 tw-text-base">
              {{ genre.name }}
            </span>
          </ng-container>
          <ng-template #noGenres>
            <span class="tw-text-gray-400 tw-ml-2 tw-text-base tw-italic">
              {{ t('media.details.noGenres') }}
            </span>
          </ng-template>
        </p>
        <div class="tw-mt-4">
          <button type="button" role="navigation" aria-label="Play media" pButton icon="pi pi-play" iconPos="left"
            label="Play" [routerLink]="['/watch', media._id]"
            class="p-button-rounded tw-block sm:tw-inline-flex tw-w-full sm:tw-w-auto tw-max-w-xs sm:tw-max-w-none tw-text-white not-disabled:hover:!tw-text-gray-600 tw-text-lg sm:tw-text-xl tw-mt-2 sm:tw-mt-0 tw-mx-auto sm:tw-mx-0 tw-px-8">
          </button>
          <button type="button" role="button" aria-label="Add media to playlist" routerLink="#" disabled="true" pButton
            icon="pi pi-plus" label="Playlist"
            class="p-button-rounded tw-block sm:tw-inline-flex tw-w-full sm:tw-w-auto tw-max-w-xs sm:tw-max-w-none tw-text-white not-disabled:hover:!tw-text-gray-600 tw-text-lg sm:tw-text-xl tw-mt-2 sm:tw-mt-0 tw-mx-auto sm:tw-mr-0 sm:tw-ml-2.5 tw-px-8">
          </button>
        </div>
        <p class="tw-text-white tw-text-base sm:tw-text-lg tw-font-medium tw-leading-5 tw-mt-4">
          {{ t('media.details.overview') }}
        </p>
        <p class="tw-text-white tw-text-sm sm:tw-text-base tw-mt-2">
          {{ media.overview }}
        </p>
        <p class="tw-text-white tw-text-base sm:tw-text-lg tw-font-medium tw-leading-5 tw-mt-4">
          {{ t('media.details.producers') }}
        </p>
        <p *ngIf="media.producers.length; else noProducers"
          class="tw-text-white tw-text-sm sm:tw-text-base tw-space-x-2 tw-mt-2">
          <span *ngFor="let producer of media.producers; trackBy: trackId">
            {{ producer.name }}
          </span>
        </p>
        <ng-template #noProducers>
          <p class="tw-text-gray-400 tw-text-sm sm:tw-text-base tw-space-x-2 tw-mt-2 tw-italic">
            {{ t('media.details.noProducers') }}
          </p>
        </ng-template>
        <p class="tw-text-white tw-text-base sm:tw-text-lg tw-font-medium tw-leading-5 tw-mt-4">
          {{ t('media.details.releaseDate') }}
        </p>
        <p class="tw-text-white tw-text-sm sm:tw-text-base tw-mt-2">
          {{ media.releaseDate | shortDate }}
        </p>
      </div>
    </div>
    <div class="tw-mt-12">
      <p class="tw-text-white tw-font-semibold tw-text-xl sm:tw-text-2xl">Videos</p>
      <form [formGroup]="addVideoForm" (ngSubmit)="onAddVideoFormSubmit()">
        <div class="tw-flex tw-flex-wrap">
          <div class="tw-w-full md:tw-w-2/6">
            <label for="name" class="tw-inline-block tw-text-base tw-font-medium tw-mb-1.5">
              {{ t('admin.addMediaVideo.name') }}
            </label>
            <input formControlName="name" class="p-inputtext-sm tw-w-full" id="name" type="text"
              aria-describedby="name-error" pInputText [disabledControl]="isAddingVideo" controlAutofocus>
            <small id="name-error"
              class="p-error tw-text-xs tw-block tw-my-2 tw-transition-opacity tw-duration-200 before:tw-content-['\200b']"
              [ngClass]="(addVideoForm.controls['name'].dirty || addVideoForm.controls['name'].touched)
                  && addVideoForm.controls['name'].invalid ? 'tw-opacity-100' : 'tw-opacity-0'">
              {{ addVideoForm.controls['name'].errors | firstErrorKey:'addMediaVideo':'name' }}
            </small>
          </div>
          <div class="tw-w-full md:tw-w-3/6 md:tw-pl-2">
            <label for="url" class="tw-inline-block tw-text-base tw-font-medium tw-mb-1.5">
              {{ t('admin.addMediaVideo.url') }}
            </label>
            <input formControlName="url" class="p-inputtext-sm tw-w-full" id="url" type="text"
              aria-describedby="url-error" pInputText [disabledControl]="isAddingVideo" controlAutofocus>
            <small id="url-error"
              class="p-error tw-text-xs tw-block tw-my-2 tw-transition-opacity tw-duration-200 before:tw-content-['\200b']"
              [ngClass]="(addVideoForm.controls['url'].dirty || addVideoForm.controls['url'].touched)
                  && addVideoForm.controls['url'].invalid ? 'tw-opacity-100' : 'tw-opacity-0'">
              {{ addVideoForm.controls['url'].errors | firstErrorKey:'addMediaVideo':'url' }}
            </small>
          </div>
          <div class="tw-w-full md:tw-w-1/6 md:tw-pl-2 tw-my-auto">
            <button pButton type="submit" [label]="t('admin.addMediaVideo.submit')" [disabled]="isAddingVideo"></button>
          </div>
        </div>
      </form>
      <ng-container *ngIf="media.videos.length; else noVideos">
        <swiper #swiperVideos [config]="swiperConfig" (update)="onUpdateVideoSwiper($event)">
          <ng-template swiperSlide *ngFor="let video of media.videos; let index = index; trackBy: trackId">
            <div
              class="tw-aspect-w-16 tw-aspect-h-9 tw-rounded-t-md tw-overflow-hidden hover:tw-brightness-75 tw-transition-all tw-duration-200"
              (click)="viewVideo(index)">
              <img [src]="youtubeThumbnailUrl + video.key + '/hqdefault.jpg'" [alt]="video.key || ''"
                class="tw-object-cover" />
              <div class="tw-flex tw-justify-center tw-items-center">
                <i class="pi bi-play-circle tw-text-4xl md:tw-text-5xl"></i>
              </div>
            </div>
            <div class="tw-bg-indigo-700 tw-rounded-b-md tw-flex">
              <button pButton type="button" label="Edit" class="p-button-secondary p-button-text p-button-sm tw-w-1/2"
                (click)="deleteVideo(video, $event)">
              </button>
              <button pButton type="button" label="Remove" class="p-button-secondary p-button-text p-button-sm tw-w-1/2"
                (click)="deleteVideo(video, $event)">
              </button>
            </div>
          </ng-template>
        </swiper>
        <p-dialog [header]="media.videos[activeVideoIndex].name" [(visible)]="displayVideo" (onHide)="blockScroll()"
          [modal]="true" styleClass="p-dialog-header-sm tw-w-2/3 tw-h-auto !tw-max-h-full" [draggable]="false"
          [resizable]="false" [dismissableMask]="true" transitionOptions="0ms linear" contentStyleClass="!tw-p-0">
          <div class="tw-aspect-w-16 tw-aspect-h-9">
            <iframe [src]="youtubeUrl + media.videos[activeVideoIndex].key + '?autoplay=1' | safeUrl: 'resourceUrl'"
              allowfullscreen width="100%" height="auto"></iframe>
          </div>
        </p-dialog>
      </ng-container>
      <ng-template #noVideos>
        <p class="tw-text-gray-400 tw-text-base tw-italic">
          {{ t('media.details.noVideos') }}
        </p>
      </ng-template>
    </div>
    <p-confirmDialog [blockScroll]="false" key="inModal" [style]="{width: '500px'}" [baseZIndex]="1000"
      acceptButtonStyleClass="p-button-danger p-button-sm"
      rejectButtonStyleClass="p-button-text p-button-secondary p-button-sm" rejectIcon="" acceptIcon=""
      [dismissableMask]="true">
    </p-confirmDialog>
  </ng-container>
</ng-container>
